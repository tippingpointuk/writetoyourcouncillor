!function(a,b,c,d){"use strict";function h(b,c){this.$element=a(b),this.settings=a.extend({},f,c),this._defaults=f,this._name=e,this.init(this.$element),this.submit=function(){this.form_submit(this.$element,this)}}var e="osdi",f={autoresponse:!0,done:function(){},fail:function(){},always:function(){},status:"subscribed",immediate:!1,ajax_options:{type:"POST",dataType:"json",contentType:"application/json"}};a.extend(h.prototype,{init:function(a){this.validate_form(a)&&this.form_submit(a,this)},validate_form:function(a){return!!a.is("form")||(console.log("JQUERY OSDI ERROR: The DOM element passed to the jQuery OSDI plugin is not a form. The jQuery OSDI plugin only supports form elements."),!1)},form_submit:function(a,b){b.settings.immediate?b.submit_handler(a,b):a.on("submit",function(){return b.submit_handler(a,b),!1})},submit_handler:function(b,c){if(c.validate_submit(b)){var d,e,f,g,h,i;d=c.create_body(b),e=c.settings.endpoint&&""!=c.settings.endpoint?"function"==typeof c.settings.endpoint?c.settings.endpoint():c.settings.endpoint:b.attr("action"),f={url:e,data:JSON.stringify(d)},f="function"==typeof c.settings.ajax_options?a.extend(f,c.settings.ajax_options()):a.extend(f,c.settings.ajax_options),g=c.settings.done,h=c.settings.fail,i=c.settings.always,c.perform_ajax(f,g,h,i)}},validate_submit:function(a){return!(!this.validate_endpoint(a)||!this.validate_add_tags())},validate_endpoint:function(a){return!(!this.settings.endpoint&&!a.attr("action"))||(console.log("JQUERY OSDI ERROR: An endpoint is required. Either set the endpoint option with a string when calling the jQuery OSDI plugin, or give your form an action attribute with the endpoint as its value."),!1)},validate_add_tags:function(){return!this.settings.add_tags||("function"==typeof this.settings.add_tags?!(!a.isArray(this.settings.add_tags())||!this.settings.add_tags().length>0)||(console.log("JQUERY OSDI ERROR: The add_tags option is not a valid array of at least one element. You must pass an array with at least one element to the jQuery OSDI plugin to add tags."),!1):!(!a.isArray(this.settings.add_tags)||!this.settings.add_tags.length>0)||(console.log("JQUERY OSDI ERROR: The add_tags option is not a valid array of at least one element. You must pass an array with at least one element to the jQuery OSDI plugin to add tags."),!1))},create_body:function(b){var c,d,e,f,g,h,i,j;if(this.settings.body)c="function"==typeof this.settings.body?this.settings.body():this.settings.body;else{if(c={person:{}},"function"==typeof this.settings.autoresponse?this.settings.autoresponse()===!0&&(d={triggers:{autoresponse:{enabled:!0}}}):this.settings.autoresponse&&this.settings.autoresponse===!0&&(d={triggers:{autoresponse:{enabled:!0}}}),a.extend(c,d),this.settings.add_tags&&(j="function"==typeof this.settings.add_tags?{add_tags:this.settings.add_tags()}:{add_tags:this.settings.add_tags},a.extend(c,j)),b.find(':input[name="family_name"]').length&&b.find(':input[name="family_name"]').val()&&(c.person.family_name=a.isArray(b.find(':input[name="family_name"]').val())?b.find(':input[name="family_name"]').val().pop():b.find(':input[name="family_name"]').val()),b.find(':input[name="given_name"]').length&&b.find(':input[name="given_name"]').val()&&(c.person.given_name=a.isArray(b.find(':input[name="given_name"]').val())?b.find(':input[name="given_name"]').val().pop():b.find(':input[name="given_name"]').val()),b.find(':input[name="email_address"]').length&&b.find(':input[name="email_address"]').val()){var k=a.isArray(b.find(':input[name="email_address"]').val())?b.find(':input[name="email_address"]').val().pop():b.find(':input[name="email_address"]').val();e={email_addresses:[{address:k}]},a.extend(c.person,e),"function"==typeof this.settings.status?this.settings.status()!==!1&&(c.person.email_addresses[0].status=this.settings.status()):this.settings.status!==!1&&(c.person.email_addresses[0].status=this.settings.status)}if((b.find(':input[name="street"]').length&&b.find(':input[name="street"]').val()||b.find(':input[name="locality"]').length&&b.find(':input[name="locality"]').val()||b.find(':input[name="region"]').length&&b.find(':input[name="region"]').val()||b.find(':input[name="postal_code"]').length&&b.find(':input[name="postal_code"]').val()||b.find(':input[name="country"]').length&&b.find(':input[name="country"]').val())&&(f={},b.find(':input[name="street"]').length&&b.find(':input[name="street"]').val()&&(f.address_lines=[a.isArray(b.find(':input[name="street"]').val())?b.find(':input[name="street"]').val().pop():b.find(':input[name="street"]').val()]),b.find(':input[name="locality"]').length&&b.find(':input[name="locality"]').val()&&(f.locality=a.isArray(b.find(':input[name="locality"]').val())?b.find(':input[name="locality"]').val().pop():b.find(':input[name="locality"]').val()),b.find(':input[name="region"]').length&&b.find(':input[name="region"]').val()&&(f.region=a.isArray(b.find(':input[name="region"]').val())?b.find(':input[name="region"]').val().pop():b.find(':input[name="region"]').val()),b.find(':input[name="postal_code"]').length&&b.find(':input[name="postal_code"]').val()&&(f.postal_code=a.isArray(b.find(':input[name="postal_code"]').val())?b.find(':input[name="postal_code"]').val().pop():b.find(':input[name="postal_code"]').val()),b.find(':input[name="country"]').length&&b.find(':input[name="country"]').val()&&(f.country=a.isArray(b.find(':input[name="country"]').val())?b.find(':input[name="country"]').val().pop():b.find(':input[name="country"]').val()),g={postal_addresses:[f]},a.extend(c.person,g)),b.find(':input[name="phone_number"]').length&&b.find(':input[name="phone_number"]').val()){var l=a.isArray(b.find(':input[name="phone_number"]').val())?b.find(':input[name="phone_number"]').val().pop():b.find(':input[name="phone_number"]').val();h={phone_numbers:[{number:l}]},a.extend(c.person,h)}b.find(':input[name^="custom["]').length&&(i={},a.each(b.find(':input[name^="custom["]').serializeArray(),function(){""!=this.value&&(i[this.name.replace(/^custom\[|\]$/g,"")]=this.value)}),a.isEmptyObject(i)||(c.person.custom_fields=i))}return c},perform_ajax:function(b,c,d,e){a.ajax(b).done(function(a,b,d){c(a,b,d)}).fail(function(a,b,c){d(a,b,c)}).always(function(a,b,c){e(a,b,c)})}}),a.fn[e]=function(b){return this.each(function(){a.data(this,"plugin_"+e)?a.data(this,"plugin_"+e).submit():a.data(this,"plugin_"+e,new h(this,b))})}}(jQuery,window,document);
